<!DOCTYPE html>
<html>
<head>
<title>Lithuanian tree cake (Å akotis)</title>
<meta charset="UTF-8">
<link rel="canonical" href="http://foldoc.org/pub/js/three.html">
</head>
<body style="overflow: hidden">
<script src="https://cdn.jsdelivr.net/npm/three/build/three.min.js"></script>
<script>
"use strict";
const pi = Math.PI;
// https://threejs.org/docs/#api/en/math/Vector3
const xUnitVector = new THREE.Vector3(1, 0, 0)
const yUnitVector = new THREE.Vector3(0, 1, 0)
const zUnitVector = new THREE.Vector3(0, 0, 1)

const spitLength = 50;
const spitRadius = 1;
let spitRotation = 0;
let dripsToAdd = 100;
const dripsFalling = [];

let camera, renderer, scene, spit;
let theta = 0;

init();

function init() {
  renderer = new THREE.WebGLRenderer({ antialias: true });
  document.body.appendChild(renderer.domElement);
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x440000);
  addCamera();
  addLight();

  spit = makeSpit();

  window.addEventListener('resize', restart);
  restart();
  scene.add(spit);
  // addDrip();
  animate();
}

function restart() {
  const { innerWidth, innerHeight } = window;
  renderer.setSize(innerWidth-17, innerHeight-15);
  renderer.setPixelRatio(window.devicePixelRatio);
  camera.aspect = innerWidth / innerHeight;
  camera.updateProjectionMatrix();
}

function animate() {
  spit.rotateOnAxis(yUnitVector, -0.01);
  spitRotation -= 0.01;
  renderer.render(scene, camera);
  requestAnimationFrame(animate);
}

// Create the spit along the x axis, centered on the origin

function makeSpit() {
  const geometry = new THREE.CylinderGeometry(spitRadius, spitRadius, spitLength, 6);
  // https://threejs.org/docs/#api/en/materials/MeshLambertMaterial
  const material = new THREE.MeshLambertMaterial({ color: 0xCCCCFF });
  // https://threejs.org/docs/#api/en/objects/Mesh
  const mesh = new THREE.Mesh(geometry, material);
  mesh.rotation.z = pi/2; // Rotate from along the y (vertical) axis to x = -len/2..len/2

  return mesh;
}

function addDrip() {
  const dripRadius = 0.3;
  const geometry = new THREE.SphereGeometry(dripRadius);
  // https://www.rapidtables.com/web/color/RGB_Color.html
  const material = new THREE.MeshBasicMaterial( { color: 0xFF9933 } );
  const mesh = new THREE.Mesh(geometry, material);
  mesh.position.set(0, randomAlongSpit(), 0);
  if (--dripsToAdd) setTimeout(addDrip, 2E3);
}

function addCamera() {
  // https://threejs.org/docs/#api/en/cameras/PerspectiveCamera
  camera = new THREE.PerspectiveCamera(70, 1, 0.1, 100);
  camera.position.set(-0.55*spitLength, 0, 10);
  camera.lookAt(-0.35*spitLength, 0, 0); // Default -ve z (into screen)
}

function addLight() {
  // https://threejs.org/docs/#api/en/lights/PointLight
  const light = new THREE.PointLight(0xFFFFFF, 2);
  light.position.set(-spitLength, 10, 10);
  scene.add(light);
}

function stickDripToSpit() {
  // Add drip to spit original position along the y axis, given the spit's current rotation
  mesh.position.set(spitRadius*Math.cos(spitRotation), randomAlongSpit(), spitRadius*Math.sin(spitRotation));
  spit.add(mesh);
}

function randomAlongSpit() { return spitLength*(Math.random()-0.5) }
</script>
</body>
</html>
