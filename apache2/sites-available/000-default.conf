# HTTPS is forwarded as HTTP

<VirtualHost *:80>
	ServerName foldoc.org
	DocumentRoot /var/www/foldoc.org
	AddHandler cgi-script .pl

	<Directory /var/www/foldoc.org>
		Options +ExecCGI
	</Directory>

	# Don't reject or decode %2F in URL
	AllowEncodedSlashes NoDecode

	RewriteEngine on

	RewriteRule ^/%%2F http://google.com [L]

	# /pub/FILE --> /_pub/FILE
	RewriteRule ^/(pub/.*) /_$1 [L]

	# ?SHORTCUT --> /_s/SHORTCUT
	RewriteCond %{DOCUMENT_ROOT}/_s/%{QUERY_STRING} -f
	RewriteRule .* /_s/%{QUERY_STRING} [L,QSD]

	# Legacy URLs
	RewriteRule (Dictionary).txt /$1  [R=301,L]
	RewriteRule ^/foldoc/(.*)	 /$1  [R=301,L]
	RewriteRule ^/home.html	 /  [R=301,L]

	# /foo --> /index.pl/foo
	# Don't rewrite path to regular file
	RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI} !-f
	# Don't rewrite index.pl - prevent redirect loop
	RewriteCond %{REQUEST_URI} !index\.pl
	# Don't rewrite /pub
	# RewriteCond %{REQUEST_URI} !/pub/
	RewriteRule (.*) /index.pl/$1 [L]

	<Directory /var/www/foldoc.org/_pub>
		Options +Indexes
		IndexOptions +ScanHTMLTitles
	</Directory>

	LogFormat "%h %t \"%r\" %>s" foldoc
	CustomLog "|/usr/bin/rotatelogs ${APACHE_LOG_DIR}/foldoc.org/access-%Y%m%d 86400" foldoc

	# Add to <head> of autoindex pages
	IndexHeadInsert "  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">"
</VirtualHost>

# In cmd:
# cd Projects\FOLDOC\apache2\sites-available
# scp 000-default.conf foldoc:/etc/apache2/sites-available& ssh foldoc apache2ctl configtest "&&" sudo apache2ctl graceful
